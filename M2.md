# M칩dulo 2

<br>

# 쯈u칠 aprenderemos?

- **Integrar** una Base de Datos No SQL, como MongoDB, en una arquitectura de microservicios.
- **Crear** y **configurar** un cluster de datos de MongoDB en [MongoDB Atlas](https://www.mongodb.com/), utilizando las herramientas disponibles en la capa gratuita.
- **Delegar** la comunicaci칩n de datos a un microservicio especializado, separando as칤 la l칩gica de las consultas a la Base de Datos de los dem치s microservicios.
- **Utilizar** la librer칤a [Mongoose ](https://mongoosejs.com/) para comunicarte con la Base de Datos MongoDB desde Javascript.

<br>

# Introducci칩n a Bases de datos No SQL

Una **base de datos NoSQL**, tambi칠n conocida como base de datos NoSQL (Not Only SQL), es un tipo de base de datos dise침ada para almacenar y recuperar grandes vol칰menes de datos no estructurados o semi-estructurados.

> Estas bases de datos son ampliamente utilizadas en aplicaciones modernas que requieren un alto rendimiento, como aplicaciones web, sistemas de gesti칩n de contenido, aplicaciones de Big Data y IoT (Internet de las cosas), entre otros. Algunos ejemplos populares de bases de datos NoSQL incluyen MongoDB, Cassandra, Redis, Couchbase y Neo4j.

A diferencia de las bases de datos SQL tradicionales, las bases de datos NoSQL no utilizan el lenguaje SQL para consultar y manipular los datos, sino que **emplean diferentes modelos de datos**, como el modelo de documentos, el modelo de columnas, el modelo clave-valor o el modelo de grafos.

## SQL vs. NoSQL

Mira con atenci칩n la siguiente tabla para atender a las diferencias entre estos dos modelos de base de datos.

|                          | SQL                                                                                             | NoSQL                                                                                                                                       |
| ------------------------ | ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| Estructura de datos      | Utiliza tablas y filas estructuradas                                                            | Utiliza diversos modelos de datos estructurados o no estructurados                                                                          |
| Escalabilidad            | Verticalmente escalable (escalado hacia arriba, m치s potencia en el servidor)                    | Horizontalmente escalable (escalado hacia fuera, agregando m치s servidores)                                                                  |
| Esquema                  | Define un esquema r칤gido antes de almacenar los datos                                           | No requiere un esquema fijo, lo que permite flexibilidad en la estructura de los datos                                                      |
| Consultas                | Utiliza SQL para consultas y manipulaci칩n de datos                                              | Utiliza modelos de consulta espec칤ficos seg칰n el modelo de datos (p. ej., consultas basadas en documentos, consultas de b칰squeda de claves) |
| Transacciones            | Soporta transacciones ACID (Atomicidad, Consistencia, Aislamiento, Durabilidad)                 | Algunas bases de datos NoSQL admiten transacciones, pero no todas                                                                           |
| Escalabilidad horizontal | Menos adecuado para grandes vol칰menes de datos y cargas de trabajo escalables horizontalmente   | M치s adecuado para grandes vol칰menes de datos y cargas de trabajo escalables horizontalmente                                                 |
| Flexibilidad             | Menos flexible en t칠rminos de cambios en el esquema y adaptabilidad a diferentes tipos de datos | Mayor flexibilidad para manejar cambios en la estructura de los datos y adaptarse a diferentes tipos de datos                               |
| Madurez y adopci칩n       | Largo historial de desarrollo y amplia adopci칩n en la industria                                 | Relativamente m치s reciente y menos adopci칩n generalizada en comparaci칩n con las bases de datos SQL                                          |
| Ejemplos                 | MySQL, PostgreSQL, Oracle                                                                       | MongoDB, Cassandra, Redis, CouchDB, Neo4j                                                                                                   |

<br>

# 쯇or qu칠 NoSQL y microservicios?

> Las Bases de Datos No SQL suelen ser m치s apropiadas en algunos sistemas de microservicios por varias razones.
> 춰Conozcamos cada una de ellas!

<details>
  <summary><b>Escalabilidad horizontal</b></summary>
  
  Las bases de datos NoSQL est치n dise침adas para escalar horizontalmente, lo que significa que puedes agregar m치s nodos o servidores para manejar el aumento de la carga de trabajo.

Esto es especialmente importante en una arquitectura de microservicios, donde cada microservicio puede tener su propia base de datos y necesitar una capacidad de escalado independiente.

Las bases de datos NoSQL facilitan la distribuci칩n y partici칩n de datos entre m칰ltiples nodos, permitiendo un escalado m치s eficiente.

</details>

<details>
  <summary><b>Esquema flexible</b></summary>
  
  En una arquitectura de microservicios, los microservicios pueden evolucionar de forma independiente y tener diferentes requisitos de datos. Una base de datos NoSQL proporciona una mayor flexibilidad en t칠rminos de cambios en el esquema, lo que facilita la adici칩n, modificaci칩n o eliminaci칩n de atributos de datos sin afectar a otros microservicios.

Esto es especialmente 칰til cuando se trabaja en un entorno 치gil o se necesita una r치pida adaptaci칩n a los cambios en los requerimientos del sistema.

</details>

<details>
  <summary><b>Modelo de datos adecuado</b></summary>
  
  Las bases de datos NoSQL ofrecen diferentes modelos de datos, como documentos, columnas, claves-valor y grafos. Estos modelos se ajustan bien a diferentes tipos de microservicios y escenarios de uso.

Por ejemplo, una base de datos de documentos como MongoDB es adecuada para almacenar datos semiestructurados, mientras que una base de datos de grafos como Neo4j es 칰til para representar relaciones complejas entre los datos. Puedes seleccionar el modelo de datos m치s adecuado para cada microservicio seg칰n sus necesidades espec칤ficas.

</details>

<details>
  <summary><b>Rendimiento y velocidad</b></summary>
  
  Las bases de datos NoSQL est치n optimizadas para consultas r치pidas y operaciones de escritura eficientes. En una arquitectura de microservicios, donde los microservicios se ejecutan de forma independiente y deben responder r치pidamente a las solicitudes, una base de datos NoSQL puede ofrecer un rendimiento superior.

Adem치s, algunos modelos de bases de datos NoSQL, como las bases de datos en memoria (como Redis), proporcionan una latencia extremadamente baja y son ideales para casos de uso donde la velocidad es cr칤tica.

</details>

<details>
  <summary><b>Adaptabilidad a la escala y la variedad</b></summary>
  
  En una arquitectura de microservicios, los microservicios pueden tener diferentes cargas de trabajo y requerir diferentes tipos de almacenamiento de datos.

Las bases de datos NoSQL ofrecen una variedad de opciones de almacenamiento, como bases de datos de alto rendimiento en memoria, almacenamiento en cach칠 distribuido y almacenamiento masivo en disco. Esto permite adaptar el almacenamiento de datos seg칰n las necesidades espec칤ficas de cada microservicio y escalarlos individualmente.

</details>

<br>

# Introducci칩n a Mongo DB y Mongo DB Atlas

## 쯈u칠 es Mongo DB?

> MongoDB es una base de datos NoSQL orientada a documentos, lo que significa que almacena los datos en forma de documentos similares a JSON en lugar de utilizar tablas y filas como las bases de datos relacionales tradicionales.

### Algunas de sus caracter칤sticas...

1. Fue desarrollada con el objetivo de brindar escalabilidad, flexibilidad y rendimiento en entornos de aplicaciones modernas.
2. Utiliza un modelo de datos flexible y din치mico, lo que permite almacenar datos con estructuras variables dentro de un mismo conjunto de datos. Esto significa que no se requiere un esquema fijo y predefinido, lo que facilita la iteraci칩n y evoluci칩n de las aplicaciones.
3. Permite distribuir la carga de trabajo en m칰ltiples servidores y manejar grandes vol칰menes de datos. Esto es especialmente 칰til en aplicaciones con altas demandas de rendimiento y escalabilidad.
4. Ofrece una amplia gama de caracter칤sticas y funcionalidades, como 칤ndices flexibles, consultas ad hoc poderosas, replicaci칩n autom치tica para alta disponibilidad, fragmentaci칩n de datos (sharding) para distribuir la carga y tolerancia a fallos, y soporte para operaciones geoespaciales.
5. Se utiliza en una variedad de aplicaciones y casos de uso, desde aplicaciones web y m칩viles hasta sistemas de gesti칩n de contenido, an치lisis de datos, IoT y muchas otras 치reas donde la flexibilidad y el rendimiento son fundamentales.

## 쯈u칠 Mongo DB Atlas?

> MongoDB Atlas es un servicio de base de datos en la nube ofrecido por MongoDB. Proporciona una forma f치cil y conveniente de alojar, administrar y escalar cl칰steres de bases de datos MongoDB en entornos en la nube, sin tener que preocuparse por la configuraci칩n y el mantenimiento de la infraestructura subyacente.

### Algunas de sus caracter칤sticas...

1. Los usuarios pueden crear cl칰steres de bases de datos MongoDB con unos pocos clics.
2. El servicio se encarga de aspectos como aprovisionamiento de hardware, configuraci칩n de la red, configuraci칩n de seguridad y respaldo de datos.
3. Permite a los desarrolladores centrarse en el desarrollo de sus aplicaciones en lugar de preocuparse por la administraci칩n de la infraestructura.

<br>

# 춰Manos a la obra!

> 游 Para poder continuar con nuestra actividad, utilizaremos como BDD No-SQL a MongoDB.

### Recordemos...

**MongoDB** es una base de datos NoSQL orientada a documentos. En lugar de utilizar tablas y filas como en las bases de datos SQL tradicionales, MongoDB almacena los datos en documentos BSON (Binary JSON).

Esta base de datos no la trabajaremos de forma local, sino que estar치 alojada en un cluster de **MongoDB Atlas**. Este es un servicio de base de datos en la nube ofrecido por MongoDB. Es una plataforma de base de datos como servicio (DBaaS) que permite a los usuarios desplegar, gestionar y escalar cl칰steres de bases de datos MongoDB en la nube de forma sencilla y que posee adem치s una capa gratuita bastante robusta.

En el siguiente video podr치s ver el paso a paso para la creaci칩n de un cluster en MongoDB Atlas y a partir de all칤 empezar a crear tu Base de Datos.

[Video](https://www.youtube.com/watch?v=J61_hiFauNs)

En el video anterior se demostr칩 como crear un cluster para crear a partir de all칤 nuestra BDD.

<br>

# HW 2 parte I

> En esta actividad nos centraremos en la creaci칩n de un microservicio dedicado exclusivamente a la conexi칩n e interacci칩n con nuestra base de datos.

Al finalizar esta actividad, tendremos una arquitectura similar a la siguiente:

![Star Wars API](./assets/M2/star_wars_api3.png)

Ten en cuenta que para poder iniciar con esta actividad, es importante que hayas generado correctamente tu cluster de datos en MongoDB Atlas. 

Adem치s, debes haber instalado en tu computadora MongoDB Compass. Esta herramienta nos servir치 para poder precargar los datos que ya tenemos de forma s칰per sencilla, y sin tener que estar generando scripts a mano para este proceso.

## 춰Comencemos! 

### **1**

En esta primera parte, crearemos con la ayuda de **MongoDB Compass** la Base de Datos de nuestro proyecto.

Luego, importamos los datos que ya tenemos guardados en nuestros archivos JSON. De esta manera, de forma muy sencilla y sin tener que desarrollar scripts, podremos tener la precarga terminada en nuestra Base de Datos y estar listos para continuar.


### ------------------------------ **Clase** ------------------------------

Ya tengo que tener creado nuestro Cluster de MongoDB Atlas y haber descargado MongoDB Compass, para hacer la precarga de los datos que necesitamos para poder trabajar.

### En MongoDB Atlas

Voy a **Database Access** y cuando lleguemos ya vamos a tener un usuario Creado al momento de crear el cl칰ster, que tiene una contrase침a que se guenera aleatoriamente y a veces no la anotamos y no la podemos recupera y tenemos que reiniciar la contrase침a.

Entonces lo mejor es crear un usuario.

Ahora voy a **Network Access**, Qu칠 cuando entro veo escrita mi IP, La puedo editar y cambiar la por `0.0.0.0/0`, Que esto significa que podemos conectar a nuestro cl칰ster desde cualquier IP. El principio es aconsejable dejarlode esta forma, luego la podemos cambiar cuando nuestra aplicaci칩n este desplegada.

Luego voy a **Database** y hacemos click en **Connect**. Nos da opciones de c칩mo nos queremos conectar. Elegimos la opci칩n de **Compass**, Y nos va a dar una URL, la vamos a copiar y a pasar a **MongoDB Compass**.

### En MongoDB Compass

Pego la URL donde dice **URI**. Tengo que cambiar el `user` y el `password` y hago click en **Connect**. Y MongoDB Compass se va a conectar con nuestro cl칰ster.

Voy a **Database**, hago click en **Create database** y le llamos `star_wars`, nos va a pedir el nombre de una primera colecci칩n, que ser칤a como una primera tabla, Que en realidad ser칤an colecciones, y le llamo `characters`.

Antes de importar Tengo que entrar al archivo `json` y cambiar los `id` por `_id`, por que MongoDB Atlas le llama as칤 a los id.

Entro a la base de datos y en `characters` hago clic en **Import Data**. 

Ya tengo cargado toda la informaci칩n que tenia en nuestro archivo `json`, en la colecci칩n `characters`. Hago lo mismo con `films` y `planets`.









### ------------------------------ **Fin clase** ------------------------------